{% extends "base.html" %}

{% block content %}
<section class="workspace" data-controller="org-dashboard" data-egida-entry="org-dashboard">
  <aside class="sidebar">
    <header class="sidebar-header">
      <h1>{{ project_name }}</h1>
      <p class="muted">Управление картой организации</p>
    </header>

    <section class="sidebar-block" id="connection">
      <h2>Подключение</h2>
      <label class="field-label" for="token">Bearer токен</label>
      <input id="token" class="field-input" type="password" placeholder="Введите access token" autocomplete="off" />
      <label class="field-label" for="org-id">ID организации</label>
      <input id="org-id" class="field-input" type="number" placeholder="1" />
      <button class="primary" data-action="load-org" title="Загрузить данные">Загрузить</button>
      <div class="alert" data-role="error" hidden></div>
      <p class="hint success" data-role="notice" hidden></p>
    </section>

    <section class="sidebar-block" id="search">
      <h2>Поиск</h2>
      <input class="field-input" type="search" placeholder="Название, описание, ответственные" data-role="search" />
    </section>

    <section class="sidebar-block" id="filters">
      <h2>Фильтры</h2>
      <label class="field-label">Сфера</label>
      <select class="field-input" data-role="filter-sphere" title="Показать узлы только выбранной сферы">
        <option value="">Все</option>
      </select>
      <label class="field-label">Тип узла</label>
      <select class="field-input" data-role="filter-type" title="Фильтр по типу узла">
        <option value="">Все</option>
      </select>
      <label class="field-label">Статус</label>
      <select class="field-input" data-role="filter-status" title="Фильтр по статусу">
        <option value="">Все</option>
      </select>
    </section>

    <section class="sidebar-block" id="spheres-panel" data-role="spheres-panel" hidden>
      <h2>Сферы</h2>
      <ul class="sphere-list" data-role="sphere-list"></ul>
      <div class="toggle layout-toggle">
        <span class="muted">Схема:</span>
        <button class="secondary" data-layout="saved">Сохранённая</button>
        <button class="secondary" data-layout="radial">Радиальная</button>
        <button class="secondary" data-layout="grid">Сетка</button>
      </div>
    </section>

    <section class="sidebar-block" id="quick-list">
      <h2>Активные узлы</h2>
      <ul class="mini-list" data-role="quick-list"></ul>
    </section>
  </aside>

  <section class="map-shell">
    <div class="map-container">
      <div id="cy" class="map-view" title="Интерактивная карта"></div>
      <div class="fab" title="Создать" data-action="toggle-actions">+</div>
      <div class="fab-menu" data-role="fab-menu" hidden>
        <button data-open-modal="node" title="Добавить узел">Добавить узел</button>
        <button data-open-modal="edge" title="Добавить связь">Добавить связь</button>
        <button data-open-modal="sphere" title="Создать сферу">Создать сферу</button>
        <button data-open-modal="export" title="Экспорт/импорт">Экспорт / импорт</button>
      </div>

      <div class="node-card" data-role="node-card" hidden>
        <header>
          <h3 data-role="node-title">Узел</h3>
          <button class="link" data-action="close-node-card" title="Закрыть">×</button>
        </header>
        <p class="node-card-meta">
          <span data-role="node-type">Тип: -</span>
          <span data-role="node-status">Статус: -</span>
        </p>
        <p class="node-card-summary" data-role="node-summary">Описание отсутствует</p>
        <div class="node-card-section" data-section="node-links" hidden>
          <h4>Ссылки</h4>
          <ul data-role="node-links"></ul>
        </div>
        <div class="node-card-section" data-section="node-owners" hidden>
          <h4>Ответственные</h4>
          <ul data-role="node-owners"></ul>
        </div>
        <div class="node-card-actions">
          <button class="secondary" data-action="archive-node" title="Перевести в архив">Архивировать</button>
          <button class="secondary" data-action="delete-node" title="Удалить узел">Удалить</button>
        </div>
      </div>
    </div>
  </section>

  <div class="modal-overlay" data-modal="node" hidden>
    <div class="modal">
      <header>
        <h3>Новый узел</h3>
        <button class="link" data-close-modal="node" title="Закрыть">×</button>
      </header>
      <div class="modal-body">
        <label class="field-label">Сфера</label>
        <select class="field-input" data-field="node-sphere">
          <option value="">Выберите сферу</option>
        </select>
        <label class="field-label">Название</label>
        <input class="field-input" type="text" data-field="node-label" placeholder="Service A" />
        <label class="field-label">Тип</label>
        <select class="field-input" data-field="node-type"></select>
        <label class="field-label">Статус</label>
        <select class="field-input" data-field="node-status"></select>
        <label class="field-label">Описание</label>
        <textarea class="field-input" rows="3" data-field="node-summary"></textarea>
        <label class="field-label">Ссылки</label>
        <textarea class="field-input" rows="2" data-field="node-links" placeholder="https://repo, https://ci"></textarea>
        <label class="field-label">Ответственные</label>
        <input class="field-input" type="text" data-field="node-owners" placeholder="ivan, anna" />
      </div>
      <footer>
        <button class="secondary" data-close-modal="node">Отмена</button>
        <button class="primary" data-action="create-node">Создать</button>
      </footer>
    </div>
  </div>

  <div class="modal-overlay" data-modal="edge" hidden>
    <div class="modal">
      <header>
        <h3>Новая связь</h3>
        <button class="link" data-close-modal="edge" title="Закрыть">×</button>
      </header>
      <div class="modal-body">
        <label class="field-label">Сфера</label>
        <select class="field-input" data-field="edge-sphere">
          <option value="">Выберите сферу</option>
        </select>
        <label class="field-label">Тип связи</label>
        <select class="field-input" data-field="edge-type"></select>
        <label class="field-label">Источник</label>
        <select class="field-input" data-field="edge-source">
          <option value="">Выберите узел</option>
        </select>
        <label class="field-label">Цель</label>
        <select class="field-input" data-field="edge-target">
          <option value="">Выберите узел</option>
        </select>
      </div>
      <footer>
        <button class="secondary" data-close-modal="edge">Отмена</button>
        <button class="primary" data-action="create-edge">Создать</button>
      </footer>
    </div>
  </div>

  <div class="modal-overlay" data-modal="sphere" hidden>
    <div class="modal">
      <header>
        <h3>Новая сфера</h3>
        <button class="link" data-close-modal="sphere" title="Закрыть">×</button>
      </header>
      <div class="modal-body">
        <label class="field-label">Название</label>
        <input class="field-input" type="text" data-field="sphere-name" placeholder="Продукт" />
        <label class="field-label">Описание</label>
        <textarea class="field-input" rows="3" data-field="sphere-description"></textarea>
        <label class="field-label">Цвет</label>
        <input class="field-input" type="color" data-field="sphere-color" />
      </div>
      <footer>
        <button class="secondary" data-close-modal="sphere">Отмена</button>
        <button class="primary" data-action="create-sphere">Создать</button>
      </footer>
    </div>
  </div>

  <div class="modal-overlay" data-modal="export" hidden>
    <div class="modal large">
      <header>
        <h3>Экспорт / импорт графа</h3>
        <button class="link" data-close-modal="export" title="Закрыть">×</button>
      </header>
      <div class="modal-body">
        <p class="hint">Экспорт формирует JSON. Для импорта вставьте подготовленный JSON и нажмите «Импортировать».</p>
        <textarea class="field-input" rows="12" data-field="export-data" spellcheck="false"></textarea>
      </div>
      <footer>
        <button class="secondary" data-action="load-export" title="Создать экспорт">Экспортировать</button>
        <button class="secondary" data-close-modal="export">Закрыть</button>
        <button class="primary" data-action="import-graph">Импортировать</button>
      </footer>
    </div>
  </div>
</section>
{% endblock %}
